# تقرير شامل عن تطبيق الويب (Web App) وآلية العمل الواقعية

## 1. نظرة عامة (Overview)
تم بناء تطبيق الويب باستخدام تقنيات حديثة لضمان السرعة والكفاءة في إدارة الكراج الذكي. يعمل التطبيق كلوحة تحكم مركزية (Dashboard) تتيح للمشغلين والمدراء مراقبة حالة الكراج لحظياً، والتحكم في البوابات، ومتابعة الإيرادات المالية.

**التقنيات المستخدمة:**
- **الإطار البرمجي:** Next.js (App Router) - لضمان أداء عالي وتجربة مستخدم سلسة.
- **الواجهة الأمامية:** React & Tailwind CSS - لتصميم متجاوب وعصري.
- **الرسوميات:** Framer Motion - لتوفير محاكاة بصرية سلسة لحركة السيارات.
- **إدارة الحالة:** React Hooks - لإدارة البيانات اللحظية (مثل حالة المواقف، سجلات الدخول).

---

## 2. تحليل الوحدات البرمجية (Code Modules Analysis)

### أ. خريطة المواقف (Parking Map)
- **في الكود:** المكون `ParkingMap.tsx` يقوم برسم شبكة (Grid) تمثل طوابق الكراج.
- **المحاكاة:** يتم تمثيل كل موقف بـ `SpotItem`. يتغير لون الموقف تلقائياً (أخضر = متاح، أحمر = مشغول) بناءً على حالة البيانات.
- **الواقع:** يرتبط هذا المكون بقاعدة البيانات التي تتلقى إشارات من **حساسات الموجات فوق الصوتية (Ultrasonic Sensors)** المثبتة في كل موقف. عند وقوف سيارة، يرسل الحساس إشارة لتحديث الحالة في النظام فوراً.

### ب. نظام الكاميرا والتعرف على اللوحات (Camera & LPR)
- **في الكود:** المكون `CameraFeed.tsx` يحاكي بث الفيديو. عند "دخول" سيارة في المحاكاة، يتم توليد رقم لوحة عشوائي وعرضه.
- **الواقع:** يتم ربط كاميرات LPR (License Plate Recognition) حقيقية عند المداخل والمخارج. تقوم الكاميرا بالتقاط صورة السيارة، ومعالجة الصورة لاستخراج النص (رقم اللوحة) وإرساله للنظام عبر API.

### ج. لوحة التحكم بالبوابة (Control Panel)
- **في الكود:** المكون `ControlPanel.tsx` يحتوي على أزرار "فتح البوابة" و"إغلاق البوابة" ومؤشرات حالة (مغلق/مفتوح).
- **الواقع:** ترتبط هذه الأزرار بـ **وحدات تحكم دقيقة (Microcontrollers/PLC)** متصلة بمحرك البوابة (Barrier Gate). عند ضغط الزر في التطبيق، يتم إرسال أمر كهربائي لفتح الذراع.

### د. التقارير المالية (Financial Report)
- **في الكود:** المكون `FinancialReport.tsx` يقوم بحساب الإيرادات بناءً على سجلات الخروج (وقت الدخول - وقت الخروج × التعرفة).
- **الواقع:** يتم الحساب تلقائياً عند خروج السيارة. يمكن ربط النظام بوابات دفع إلكتروني (POS) أو الدفع النقدي، ويتم تسجيل كل عملية مالية في قاعدة بيانات آمنة لمنع التلاعب.

---

## 3. آلية العمل المعتمدة (Workflow Mechanism)

بناءً على المحاكاة في الكود، فإن دورة العمل الواقعية ستكون كالتالي:

### سيناريو الدخول (Entry Scenario):
1.  **الوصول:** تقترب السيارة من بوابة الدخول.
2.  **الكشف:** يستشعر "حساس أرضي" (Loop Detector) وجود السيارة.
3.  **التعرف:** تلتقط الكاميرا صورة اللوحة وتقرأ الرقم (مثلاً: `BAG-1234`).
4.  **التحقق:** يفحص النظام ما إذا كانت السيارة في القائمة السوداء أو إذا كان الكراج ممتلئاً.
5.  **الإجراء:**
    -   إذا كان مسموحاً: تفتح البوابة تلقائياً، ويسجل النظام وقت الدخول.
    -   تظهر رسالة ترحيبية على الشاشة الجانبية.
6.  **التوجيه:** يوجه النظام السائق إلى أقرب طابق به شواغر (بناءً على عداد المواقف).

### سيناريو الخروج (Exit Scenario):
1.  **الوصول:** تقترب السيارة من بوابة الخروج.
2.  **التعرف:** تقرأ الكاميرا اللوحة مرة أخرى.
3.  **المعالجة:**
    -   يسترجع النظام وقت الدخول.
    -   يحسب المدة (مثلاً: ساعتان).
    -   يحسب التكلفة (مثلاً: 3000 دينار).
4.  **الدفع:** يظهر المبلغ على شاشة الكاشير أو شاشة السائق.
5.  **المغادرة:** بعد تأكيد الدفع، تفتح البوابة وتتغير حالة الموقف في النظام إلى "متاح".

---

## 4. التوصيات التقنية للتنفيذ
- **الشبكة:** يجب توفير شبكة محلية (LAN) سريعة لربط الكاميرات بالسيرفر لضمان سرعة معالجة الفيديو.
- **السيرفر:** يفضل استخدام سيرفر محلي (Local Server) داخل الكراج لضمان عمل النظام حتى في حال انقطاع الإنترنت.
- **النسخ الاحتياطي:** تفعيل نظام نسخ احتياطي (Backup) يومي لقاعدة البيانات المالية.
